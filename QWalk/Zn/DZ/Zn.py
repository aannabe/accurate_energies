#! /usr/bin/env python3

import sys,os
from pyscf import scf,gto,lib
import numpy as np

#workdir = os.path.realpath(os.path.join(__file__,'/home/gani/Desktop/notes/scripts/genbas/basis'))
#workdir=dirpath = os.getcwd()
#basfile = os.path.join(workdir,'nwchem.bas')

#~~~~Build the molecule~~~~
mol = gto.Mole()
mol.atom = '''Zn 0.0 0.0 0.0 '''
#mol.basis = {'Zn': gto.load(basfile,'Zn')}
#mol.basis = {'Zn':'bfd-vtz'}
mol.basis = {'Zn': gto.basis.parse('''
Zn S
     114.485022  0.00042900
      61.996430  -0.01933900
      40.117132  0.08625400
      20.119649  -0.08895500
      10.171676  -0.40267100
       5.601641  0.06730400
       2.864122  0.47921500
       1.592779  0.50396000
       0.826525  0.22208800
       0.263975  0.01220300
       0.145302  -0.00430000
       0.068195  0.00124300
       0.031465  -0.00026700
Zn S
     114.485022  -0.00010900
      61.996430  0.00445900
      40.117132  -0.02006700
      20.119649  0.02233800
      10.171676  0.09669800
       5.601641  -0.02196600
       2.864122  -0.12876800
       1.592779  -0.18170600
       0.826525  -0.16231100
       0.263975  0.11626400
       0.145302  0.41131400
       0.068195  0.49425700
       0.031465  0.13810300
Zn S
     114.485022  0.00066600
      61.996430  0.00626900
      40.117132  -0.04660300
      20.119649  0.05039900
      10.171676  0.36349300
       5.601641  -0.24284000
       2.864122  -0.38228100
       1.592779  -0.86156700
       0.826525  0.70607700
       0.263975  1.49500100
       0.145302  -0.45399400
       0.068195  -0.59782200
       0.031465  -0.25611700
Zn S
       0.031465  1.00000000
Zn S
       0.015000  1.00000000
Zn P
     158.770986  -0.00015300
      75.802876  0.00189300
      44.547824  0.01046100
      31.445269  -0.04514100
      13.080125  -0.08420100
       7.788616  0.10497300
       4.195040  0.30771400
       2.362276  0.36856300
       1.302584  0.28633600
       0.660704  0.09515600
       0.249042  0.00585100
       0.091781  -0.00003400
       0.048931  0.00025200
Zn P
     158.770986  0.00005300
      75.802876  -0.00057100
      44.547824  -0.00107300
      31.445269  0.00746300
      13.080125  0.01867600
       7.788616  -0.02809000
       4.195040  -0.05443800
       2.362276  -0.09374400
       1.302584  -0.05416900
       0.660704  -0.00797200
       0.249042  0.35619800
       0.091781  0.41239900
       0.048931  0.36132100
Zn P
     158.770986  -0.00017000
      75.802876  0.00060400
      44.547824  -0.01998700
      31.445269  0.06115300
      13.080125  0.06731700
       7.788616  -0.13921100
       4.195040  -0.52704100
       2.362276  -0.17619400
       1.302584  0.03712900
       0.660704  1.07932200
       0.249042  -0.05014900
       0.091781  -0.68897100
       0.048931  0.03733100
Zn P
       0.048931  1.00000000
Zn P
       0.024000  1.00000000
Zn D
     270.014061  -0.00001600
     100.161579  0.00069600
      43.530609  0.01353600
      21.262419  0.06935000
      10.577821  0.14955900
       5.343620  0.23958800
       2.704857  0.28674400
       1.353018  0.27145900
       0.660873  0.20242600
       0.309149  0.10330700
       0.133879  0.02321100
Zn D
     270.014061  0.00001300
     100.161579  -0.00088900
      43.530609  -0.01864000
      21.262419  -0.09464600
      10.577821  -0.21565900
       5.343620  -0.32246900
       2.704857  -0.19752900
       1.353018  0.16444800
       0.660873  0.41001700
       0.309149  0.32783800
       0.133879  0.10574900
Zn D
       0.133879  1.00000000
Zn D
       0.060000  1.00000000
Zn F
       0.893402  1.00000000
Zn F
       3.171936  1.00000000
''')}

mol.symmetry = 'D2h'
mol.spin = 0	# 2S
mol.charge = 0
#mol.ecp={'Zn':'bfd'}
mol.ecp={'Zn': gto.basis.parse_ecp('''
Zn nelec 10
Zn ul
1 35.80797616   20.00000000
3 34.53646083  716.15952323
2 28.62830178 -204.68393323
2  7.96239682    0.76026614
Zn s
2 35.02141356  431.70804302
2 14.63498691   95.87640437
Zn p
2 42.22979234  313.57770563
2 14.57429304   74.01270048

''')}
mol.build()

#~~~Run HF on molecule~~~~
hf = scf.ROHF(mol) #.apply(scf.addons.remove_linear_dep_)
hf.irrep_nelec = {
'Ag' : (4,4),   # s    
'B3u': (1,1),   # x    1
'B1u': (1,1),   # z    0
'B2u': (1,1),   # y   -1
'B1g': (1,1),   # xy  -2
'B3g': (1,1),   # yz  -1
'B2g': (1,1),   # xz   1
'Au' : (0,0)    # xyz  
}
hf.verbose=4
hf.max_cycle=150
#hf.level_shift=0.5
#hf.diis_space=8
#dm=hf.init_guess_by_chkfile('../guess/Zn.chkfile')
#hf.init_guess='hcore'
hf.chkfile='Zn.chkfile'
en=hf.kernel()
#en=hf.kernel(dm)

###~~~~~~~~ Reorder orbitals ~~~~~~~~~~~~~~

##hf.analyze()
#mo0 = hf.mo_coeff
#occ = hf.mo_occ
#occ[1][5] = 0 
#occ[1][10] = 1
#hf = scf.UHF(mol)
#hf.irrep_nelec = {
#'Ag' : (4,3),   # s    
#'B3u': (1,1),   # x    1
#'B1u': (1,1),   # z    0
#'B2u': (1,1),   # y   -1
#'B1g': (1,0),   # xy  -2
#'B3g': (1,0),   # yz  -1
#'B2g': (1,0),   # xz   1
#'Au' : (0,0)    # xyz  
#}
#dm_u = hf.make_rdm1(mo0, occ)
#hf = scf.addons.mom_occ(hf, mo0, occ)
#hf.scf(dm_u)
#hf.mulliken_pop()

#dm1 = hf.make_rdm1()
#mf=scf.ROHF(mol)
#mf.chkfile='Zn.chkfile'
#hf.irrep_nelec = {
#'Ag' : (4,3),   # s    
#'B3u': (1,1),   # x    1
#'B1u': (1,1),   # z    0
#'B2u': (1,1),   # y   -1
#'B1g': (1,0),   # xy  -2
#'B3g': (1,0),   # yz  -1
#'B2g': (1,0),   # xz   1
#'Au' : (0,0)    # xyz  
#}
#mf.kernel(dm1)
#
#mf.mulliken_pop()

hf.mulliken_pop()

