#! /usr/bin/env python3

import sys,os
from pyscf import scf,gto,lib
import numpy as np

#workdir = os.path.realpath(os.path.join(__file__,'/home/gani/Desktop/notes/scripts/genbas/basis'))
#workdir=dirpath = os.getcwd()
#basfile = os.path.join(workdir,'nwchem.bas')

#~~~~Build the molecule~~~~
mol = gto.Mole()
mol.atom = '''Mn 0.0 0.0 0.0 '''
#mol.basis = {'Mn': gto.load(basfile,'Mn')}
#mol.basis = {'Mn':'bfd-vtz'}
mol.basis = {'Mn': gto.basis.parse('''
Mn S
      76.008334  0.00099300
      39.277974  -0.01479600
      20.405805  0.12071000
      12.218680  -0.12400100
       7.182690  -0.32020000
       3.850780  -0.10562200
       2.142489  0.47272100
       1.049631  0.62038700
       0.508682  0.20455300
       0.192243  0.00592400
       0.108899  -0.00009700
       0.053425  -0.00018500
       0.025236  0.00006100
Mn S
      76.008334  -0.00019900
      39.277974  0.00335200
      20.405805  -0.02941300
      12.218680  0.03209100
       7.182690  0.08315200
       3.850780  0.02128300
       2.142489  -0.12998900
       1.049631  -0.23900600
       0.508682  -0.18031500
       0.192243  0.11014800
       0.108899  0.40442600
       0.053425  0.51730700
       0.025236  0.14813900
Mn S
      76.008334  -0.00009100
      39.277974  0.00537400
      20.405805  -0.05849400
      12.218680  0.05634500
       7.182690  0.22787400
       3.850780  -0.00842000
       2.142489  -0.32077700
       1.049631  -0.81313700
       0.508682  0.32647500
       0.192243  1.44754000
       0.108899  0.02132100
       0.053425  -0.67832300
       0.025236  -0.45282800
Mn S
       0.025236  1.00000000
Mn S
       0.012000  1.00000000
Mn P
     113.479709  0.00010300
      58.160819  -0.00089400
      30.043076  0.00884400
      16.753323  -0.01968500
      10.705604  -0.06919000
       5.557903  0.01150800
       3.080151  0.28231300
       1.582963  0.43867800
       0.810922  0.30984300
       0.413396  0.08394500
       0.195480  0.00751700
       0.072688  0.00110000
       0.035877  0.00029000
Mn P
     113.479709  0.00001900
      58.160819  -0.00002400
      30.043076  -0.00122400
      16.753323  0.00232000
      10.705604  0.02075800
       5.557903  -0.01157200
       3.080151  -0.06291900
       1.582963  -0.13675400
       0.810922  -0.06729500
       0.413396  -0.03102400
       0.195480  0.37898100
       0.072688  0.50782400
       0.035877  0.26094100
Mn P
     113.479709  -0.00019700
      58.160819  0.00135400
      30.043076  -0.01010200
      16.753323  0.03060300
      10.705604  0.04620000
       5.557903  -0.01758800
       3.080151  -0.39592000
       1.582963  -0.41909300
       0.810922  0.07501700
       0.413396  1.09298600
       0.195480  0.00868000
       0.072688  -0.75636900
       0.035877  -0.04514900
Mn P
       0.035877  1.00000000
Mn P
       0.017000  1.00000000
Mn D
     132.688182  0.00003000
      45.266024  0.00529400
      23.267336  0.02914300
      10.605694  0.07677500
       5.074684  0.16855100
       2.469857  0.25683200
       1.205883  0.28989100
       0.590569  0.25715400
       0.292055  0.18172600
       0.149190  0.08998600
       0.076511  0.03459500
Mn D
     132.688182  -0.00002100
      45.266024  -0.00544900
      23.267336  -0.02903200
      10.605694  -0.07982500
       5.074684  -0.17441500
       2.469857  -0.25340400
       1.205883  -0.17430500
       0.590569  0.04508100
       0.292055  0.34576000
       0.149190  0.26372500
       0.076511  0.37171500
Mn D
       0.076511  1.00000000
Mn D
       0.034000  1.00000000
Mn F
       0.373591  1.00000000
Mn F
       1.357898  1.00000000
''')}

mol.symmetry = 'D2h'
mol.spin = 5	# 2S
mol.charge = 0
#mol.ecp={'Mn':'bfd'}
mol.ecp={'Mn': gto.basis.parse_ecp('''
Mn nelec 10
Mn ul
1 21.91937433   15.00000000
3 21.35527127  328.79061500
2 21.27162653 -162.05172805
2  7.93913962   -1.82694272
Mn s
2 18.92044965  244.66870492
2  8.32764757   33.54162717
Mn p
2 20.17347020  162.35033685
2  7.80047874   24.17956695

''')}
mol.build()

#~~~Run HF on molecule~~~~
hf = scf.ROHF(mol) #.apply(scf.addons.remove_linear_dep_)
hf.irrep_nelec = {
'Ag' : (4,2),   # s    
'B3u': (1,1),   # x    1
'B1u': (1,1),   # z    0
'B2u': (1,1),   # y   -1
'B1g': (1,0),   # xy  -2
'B3g': (1,0),   # yz  -1
'B2g': (1,0),   # xz   1
'Au' : (0,0)    # xyz  
}
hf.verbose=4
hf.max_cycle=150
#hf.level_shift=0.8
#hf.diis_space=8
#dm=hf.init_guess_by_chkfile('../guess/Mn.chkfile')
#hf.init_guess='1e'
hf.chkfile='Mn.chkfile'
en=hf.kernel()
#en=hf.kernel(dm)

###~~~~~~~~ Reorder orbitals ~~~~~~~~~~~~~~
hf.analyze()
#mo0 = hf.mo_coeff
#occ = hf.mo_occ
#occ[6]  = 0 
#occ[12] = 1
#hf = scf.ROHF(mol)
#hf.irrep_nelec = {
#'Ag' : (4,2),   # s    
#'B3u': (1,1),   # x    1
#'B1u': (1,1),   # z    0
#'B2u': (1,1),   # y   -1
#'B1g': (0,0),   # xy  -2
#'B3g': (0,0),   # yz  -1
#'B2g': (1,0),   # xz   1
#'Au' : (0,0)    # xyz  
#}
#dm_u = hf.make_rdm1(mo0, occ)
#hf = scf.addons.mom_occ(hf, mo0, occ)
#hf.scf(dm_u)

#hf.mulliken_pop()

