#! /usr/bin/env python3

import sys,os
from pyscf import scf,gto,lib
import numpy as np

#workdir = os.path.realpath(os.path.join(__file__,'/home/gani/Desktop/notes/scripts/genbas/basis'))
#workdir=dirpath = os.getcwd()
#basfile = os.path.join(workdir,'nwchem.bas')

#~~~~Build the molecule~~~~
mol = gto.Mole()
mol.atom = '''V 0.0 0.0 0.0 '''
#mol.basis = {'V': gto.load(basfile,'V')}
#mol.basis = {'V':'bfd-vtz'}
mol.basis = {'V': gto.basis.parse('''
V S
      68.577621  0.00080400
      34.937147  -0.01159400
      17.939491  0.09220900
      11.262123  -0.04547700
       6.776264  -0.28798300
       3.524091  -0.21764800
       1.938421  0.40750900
       0.927153  0.65819300
       0.448420  0.25523400
       0.209668  0.00862000
       0.103660  0.00273400
       0.050630  -0.00116100
       0.024201  0.00029400
V S
      68.577621  -0.00017700
      34.937147  0.00279100
      17.939491  -0.02365000
      11.262123  0.01250400
       6.776264  0.07876100
       3.524091  0.05497400
       1.938421  -0.11895500
       0.927153  -0.24534100
       0.448420  -0.22295900
       0.209668  0.04780900
       0.103660  0.41537400
       0.050630  0.54088000
       0.024201  0.18342100
V S
      68.577621  -0.00058300
      34.937147  0.00957000
      17.939491  -0.08560600
      11.262123  0.04842600
       6.776264  0.33123900
       3.524091  0.14035200
       1.938421  -0.90796200
       0.927153  -0.50387800
       0.448420  0.39893800
       0.209668  0.97113100
       0.103660  0.42399900
       0.050630  -0.62864600
       0.024201  -0.46749500
V S
      68.577621  -0.00076500
      34.937147  0.01452900
      17.939491  -0.13961800
      11.262123  0.06307300
       6.776264  0.70419300
       3.524091  -0.01160200
       1.938421  -2.31160400
       0.927153  0.76826900
       0.448420  2.16892000
       0.209668  -1.06267100
       0.103660  -1.21815100
       0.050630  0.34080900
       0.024201  0.71332200
V S
       0.024201  1.00000000
V S
       0.012000  1.00000000
V P
      96.215967  0.00006900
      49.579340  -0.00067200
      25.638009  0.00819900
      14.025942  -0.02710800
       8.740334  -0.05302100
       4.634840  0.00500200
       2.553374  0.26198600
       1.321166  0.43354400
       0.681285  0.32494700
       0.349458  0.09234200
       0.172773  0.00896400
       0.063300  0.00118500
       0.033969  0.00010400
V P
      96.215967  0.00004000
      49.579340  -0.00013300
      25.638009  -0.00095500
      14.025942  0.00371900
       8.740334  0.01886600
       4.634840  -0.01207400
       2.553374  -0.05710700
       1.321166  -0.14643300
       0.681285  -0.06736500
       0.349458  -0.06825400
       0.172773  0.40310300
       0.063300  0.50266800
       0.033969  0.26129100
V P
      96.215967  -0.00005300
      49.579340  0.00002300
      25.638009  0.00462900
      14.025942  -0.00775500
       8.740334  -0.10413300
       4.634840  -0.01776200
       2.553374  0.72821200
       1.321166  0.21882600
       0.681285  -0.49322300
       0.349458  -0.83819200
       0.172773  0.39840100
       0.063300  0.66458900
       0.033969  0.03301100
V P
      96.215967  -0.00126200
      49.579340  0.00641900
      25.638009  -0.02122900
      14.025942  0.11577700
       8.740334  -0.42074000
       4.634840  0.19774200
       2.553374  1.57560000
       1.321166  -1.06791300
       0.681285  -1.31008300
       0.349458  1.19114700
       0.172773  0.55051600
       0.063300  -0.71878800
       0.033969  -0.15744100
V P
       0.033969  1.00000000
V P
       0.016000  1.00000000
V D
      89.989649  0.00005100
      33.132961  0.00480400
      15.879656  0.02948500
       7.465803  0.08624900
       3.551993  0.17972800
       1.728185  0.26185000
       0.850498  0.29179400
       0.417673  0.25935600
       0.201523  0.17494400
       0.100711  0.06227800
       0.058959  0.02765300
V D
      89.989649  -0.00003800
      33.132961  -0.00459000
      15.879656  -0.02756300
       7.465803  -0.08277500
       3.551993  -0.17349400
       1.728185  -0.23618800
       0.850498  -0.14922600
       0.417673  0.04414500
       0.201523  0.39050000
       0.100711  0.20306400
       0.058959  0.39800200
V D
      89.989649  0.00012800
      33.132961  0.00665200
      15.879656  0.04463500
       7.465803  0.12255900
       3.551993  0.31114700
       1.728185  0.28881300
       0.850498  -0.14224600
       0.417673  -0.61373700
       0.201523  -0.12391600
       0.100711  -0.02023500
       0.058959  0.73325900
V D
       0.058959  1.00000000
V D
       0.027000  1.00000000
V F
       0.131136  1.00000000
V F
       0.552620  1.00000000
V F
       2.328788  1.00000000
V G
       0.616440  1.00000000
V G
       1.977796  1.00000000
''')}

mol.symmetry = 'D2h'
mol.spin = 3	# 2S
mol.charge = 0
#mol.ecp={'V':'bfd'}
mol.ecp={'V': gto.basis.parse_ecp('''
V nelec 10
V ul
1 20.32168914   13.00000000
3 19.59698040  264.18195885
2 17.33147348 -115.29293208
2  5.12320657   -0.66288726
V s
2 15.12502150  195.56713891
2  6.29898914   22.88642834
V p
2 15.93855113  126.42119500
2  5.74006266   16.03597127
''')}
mol.build()

#~~~Run HF on molecule~~~~
hf = scf.ROHF(mol) #.apply(scf.addons.remove_linear_dep_)
hf.irrep_nelec = {
'Ag' : (4,2),   # s    
'B3u': (1,1),   # x    1
'B1u': (1,1),   # z    0
'B2u': (1,1),   # y   -1
'B1g': (0,0),   # xy  -2
'B3g': (0,0),   # yz  -1
'B2g': (1,0),   # xz   1
'Au' : (0,0)    # xyz  
}
hf.verbose=4
hf.max_cycle=150
#hf.level_shift=0.5
dm=hf.init_guess_by_chkfile('../guess/V.chkfile')
hf.chkfile='V.chkfile'
#en=hf.kernel()
en=hf.kernel(dm)

###~~~~~~~~ Reorder orbitals ~~~~~~~~~~~~~~
hf.analyze()
#mo0 = hf.mo_coeff
#occ = hf.mo_occ
#occ[6]  = 0 
#occ[12] = 1
#hf = scf.ROHF(mol)
#hf.irrep_nelec = {
#'Ag' : (4,2),   # s    
#'B3u': (1,1),   # x    1
#'B1u': (1,1),   # z    0
#'B2u': (1,1),   # y   -1
#'B1g': (0,0),   # xy  -2
#'B3g': (0,0),   # yz  -1
#'B2g': (1,0),   # xz   1
#'Au' : (0,0)    # xyz  
#}
#dm_u = hf.make_rdm1(mo0, occ)
#hf = scf.addons.mom_occ(hf, mo0, occ)
#hf.scf(dm_u)

hf.mulliken_pop()

