#! /usr/bin/env python3

import sys,os
from pyscf import scf,gto,lib
import numpy as np

#workdir = os.path.realpath(os.path.join(__file__,'/home/gani/Desktop/notes/scripts/genbas/basis'))
#workdir=dirpath = os.getcwd()
#basfile = os.path.join(workdir,'nwchem.bas')

#~~~~Build the molecule~~~~
mol = gto.Mole()
mol.atom = '''Fe 0.0 0.0 0.0 '''
#mol.basis = {'Fe': gto.load(basfile,'Fe')}
#mol.basis = {'Fe':'bfd-vtz'}
mol.basis = {'Fe': gto.basis.parse('''
Fe S
      84.322332  0.00078500
      44.203528  -0.01278100
      23.288963  0.10463500
      13.385163  -0.11938500
       7.518052  -0.33980400
       4.101835  -0.04999400
       2.253571  0.47695500
       1.134924  0.59322200
       0.561550  0.20015100
       0.201961  0.00859100
       0.108698  -0.00218800
       0.053619  0.00067700
       0.025823  -0.00014400
Fe S
      84.322332  -0.00016200
      44.203528  0.00292100
      23.288963  -0.02546600
      13.385163  0.03118200
       7.518052  0.08684900
       4.101835  0.00684600
       2.253571  -0.13185600
       1.134924  -0.22774600
       0.561550  -0.17307900
       0.201961  0.13614200
       0.108698  0.43401300
       0.053619  0.47755500
       0.025823  0.12880400
Fe S
      84.322332  0.00000200
      44.203528  0.00410300
      23.288963  -0.04684000
      13.385163  0.05283300
       7.518052  0.21809400
       4.101835  -0.04499900
       2.253571  -0.28738600
       1.134924  -0.71322000
       0.561550  0.24917400
       0.201961  1.29987200
       0.108698  0.19211900
       0.053619  -0.65861600
       0.025823  -0.52104700
Fe S
       0.025823  1.00000000
Fe S
       0.012000  1.00000000
Fe P
     125.092775  0.00005600
      65.211589  -0.00057200
      34.437599  0.00738800
      18.930704  -0.02848100
      10.873415  -0.06300500
       6.012172  0.02485500
       3.372205  0.27747400
       1.768641  0.42538600
       0.914516  0.31414500
       0.460895  0.09042200
       0.204490  0.00697700
       0.074741  0.00115400
       0.035671  0.00030300
Fe P
     125.092775  0.00002500
      65.211589  -0.00007000
      34.437599  -0.00104200
      18.930704  0.00512700
      10.873415  0.01840400
       6.012172  -0.01469200
       3.372205  -0.06130700
       1.768641  -0.12863800
       0.914516  -0.07063700
       0.460895  -0.01631400
       0.204490  0.38070200
       0.074741  0.52307100
       0.035671  0.23576500
Fe P
     125.092775  -0.00019700
      65.211589  0.00125100
      34.437599  -0.00915400
      18.930704  0.03820100
      10.873415  0.04309700
       6.012172  -0.02947500
       3.372205  -0.42699600
       1.768641  -0.39484000
       0.914516  0.07723000
       0.460895  1.11988100
       0.204490  -0.06649400
       0.074741  -0.72158300
       0.035671  -0.00569500
Fe P
       0.035671  1.00000000
Fe P
       0.017000  1.00000000
Fe D
     152.736742  0.00002900
      50.772485  0.00523800
      26.253589  0.02932500
      12.137022  0.07490100
       5.853719  0.16341100
       2.856224  0.25105700
       1.386132  0.28760300
       0.670802  0.25186200
       0.330280  0.18673600
       0.170907  0.09357000
       0.086794  0.07381100
Fe D
     152.736742  -0.00002600
      50.772485  -0.00632900
      26.253589  -0.03439800
      12.137022  -0.09176500
       5.853719  -0.20159200
       2.856224  -0.28393000
       1.386132  -0.16198100
       0.670802  0.12882200
       0.330280  0.36016000
       0.170907  0.27759200
       0.086794  0.26140300
Fe D
       0.086794  1.00000000
Fe D
       0.040000  1.00000000
Fe F
       0.463696  1.00000000
Fe F
       1.696126  1.00000000
''')}

mol.symmetry = 'D2h'
mol.spin = 4	# 2S
mol.charge = 0
#mol.ecp={'Fe':'bfd'}
mol.ecp={'Fe': gto.basis.parse_ecp('''
Fe nelec 10
Fe ul
1 23.22091713   16.00000000
3 23.54714679  371.53467417
2 23.47256344 -181.22603445
2  9.85238815   -2.37305236
Fe s
2 22.21062697  277.50032547
2  9.51515800   46.20495585
Fe p
2 24.57000871  194.99875056
2  8.86648776   31.67945132

''')}
mol.build()

#~~~Run HF on molecule~~~~
hf = scf.ROHF(mol) #.apply(scf.addons.remove_linear_dep_)
hf.irrep_nelec = {
'Ag' : (4,3),   # s    
'B3u': (1,1),   # x    1
'B1u': (1,1),   # z    0
'B2u': (1,1),   # y   -1
'B1g': (1,0),   # xy  -2
'B3g': (1,0),   # yz  -1
'B2g': (1,0),   # xz   1
'Au' : (0,0)    # xyz  
}
hf.verbose=4
hf.max_cycle=150
hf.level_shift=0.5
#hf.diis_space=8
dm=hf.init_guess_by_chkfile('../guess/Fe.chkfile')
#hf.init_guess='hcore'
hf.chkfile='Fe.chkfile'
#en=hf.kernel()
en=hf.kernel(dm)

###~~~~~~~~ Reorder orbitals ~~~~~~~~~~~~~~

##hf.analyze()
#mo0 = hf.mo_coeff
#occ = hf.mo_occ
#occ[1][5] = 0 
#occ[1][10] = 1
#hf = scf.UHF(mol)
#hf.irrep_nelec = {
#'Ag' : (4,3),   # s    
#'B3u': (1,1),   # x    1
#'B1u': (1,1),   # z    0
#'B2u': (1,1),   # y   -1
#'B1g': (1,0),   # xy  -2
#'B3g': (1,0),   # yz  -1
#'B2g': (1,0),   # xz   1
#'Au' : (0,0)    # xyz  
#}
#dm_u = hf.make_rdm1(mo0, occ)
#hf = scf.addons.mom_occ(hf, mo0, occ)
#hf.scf(dm_u)
#hf.mulliken_pop()

#dm1 = hf.make_rdm1()
#mf=scf.ROHF(mol)
#mf.chkfile='Fe.chkfile'
#hf.irrep_nelec = {
#'Ag' : (4,3),   # s    
#'B3u': (1,1),   # x    1
#'B1u': (1,1),   # z    0
#'B2u': (1,1),   # y   -1
#'B1g': (1,0),   # xy  -2
#'B3g': (1,0),   # yz  -1
#'B2g': (1,0),   # xz   1
#'Au' : (0,0)    # xyz  
#}
#mf.kernel(dm1)
#
#mf.mulliken_pop()

hf.mulliken_pop()

